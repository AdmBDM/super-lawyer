# –†–µ–≥–ª–∞–º–µ–Ω—Ç —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ super-lawyer

---

## 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –û–∫—Ä—É–∂–µ–Ω–∏–µ       | –ü—É—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ                             | –í–µ—Ç–∫–∞ GitHub    | –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è              |
|-----------------|----------------------------------------------------|-----------------|----------------------------|
| –õ–æ–∫–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞| `R:\www\jurist\dev`                                | develop (–ª–æ–∫–∞–ª—å–Ω–æ) | ‚Äî                          |
| –¢–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä | `/var/www/www-root/data/www/test.super-lawyer.ru` | develop         | `scripts/deploy_test.sh`   |
| –ë–æ–µ–≤–æ–π —Å–µ—Ä–≤–µ—Ä   | `/var/www/www-root/data/www/super-lawyer.ru`      | main            | `scripts/deploy_prod.sh`   |

---

## 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

- –°–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `super-lawyer` –Ω–∞ GitHub.
- –°–æ–∑–¥–∞—Ç—å –¥–≤–µ –≤–µ—Ç–∫–∏: `main` (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω) –∏ `develop` (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏).
- –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ –∏ —Å–µ—Ä–≤–µ—Ä–∞—Ö.
- –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ –≤–µ—Å—Ç–∏ —Ä–∞–±–æ—Ç—É –≤ –≤–µ—Ç–∫–µ `develop`, –ø—É—à–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç—É–¥–∞.
- –ü—Ä–æ–≤–æ–¥–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ.
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–ª–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ `develop` –≤ `main` –∏ –¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ –±–æ–µ–≤–æ–π —Å–µ—Ä–≤–µ—Ä.

---

## 3. –†–∞–±–æ—Ç–∞ —Å SSH

- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å SSH-–∫–ª—é—á —Å –∏–º–µ–Ω–µ–º `id_ed25519_vhs` (–±–µ–∑ –ø–∞—Ä–æ–ª—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏).
- –î–æ–±–∞–≤–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ `~/.ssh/authorized_keys` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö.
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSH-–¥–æ—Å—Ç—É–ø —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –∫ —Å–µ—Ä–≤–µ—Ä–∞–º –∏ GitHub.
- –î–æ–±–∞–≤–∏—Ç—å –≤ Git –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö:
  ```
  git config --global --add safe.directory /–ø—É—Ç—å/–∫/–ø—Ä–æ–µ–∫—Ç—É
  ```

---

## 4. –°–∫—Ä–∏–ø—Ç—ã –¥–µ–ø–ª–æ—è

### 4.1 –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–∞–≤–∞

- –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `scripts/` –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.
- –ü–æ–º–µ—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –¥–µ–ø–ª–æ—è –≤ —ç—Ç—É –ø–∞–ø–∫—É:
  - `deploy_test.sh` ‚Äî –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.
  - `deploy_prod.sh` ‚Äî –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–µ—Ä–≤–µ—Ä–∞.
- –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏:  
  ```bash
  chmod +x scripts/deploy_*.sh
  ```
- –î–æ–±–∞–≤–∏—Ç—å –≤ `.gitignore` –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ —Å—Ç—Ä–æ–∫—É:
  ```
  /scripts/deploy_*.sh
  ```
  —á—Ç–æ–±—ã —Å–∫—Ä–∏–ø—Ç—ã –Ω–µ –ø–æ–ø–∞–¥–∞–ª–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

### 4.2 –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (`deploy_test.sh`)

```bash
#!/bin/bash

echo "üîÑ Resetting to origin/develop..."
git fetch origin
git reset --hard origin/develop || exit 1

echo "üì¶ Installing composer dependencies..."
composer install --no-interaction --prefer-dist || exit 1

echo "üîÉ Running migrations..."
php yii migrate --interactive=0 || exit 1

echo "‚úÖ Deploy complete."
```

### 4.3 –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–µ—Ä–≤–µ—Ä–∞ (`deploy_prod.sh`)

```bash
#!/bin/bash

echo "üîÑ Resetting to origin/main..."
git fetch origin
git reset --hard origin/main || exit 1

echo "üì¶ Installing composer dependencies..."
export COMPOSER_ALLOW_SUPERUSER=1
composer install --no-dev --no-interaction --prefer-dist || exit 1

echo "üîÉ Running migrations..."
php yii migrate --interactive=0 || exit 1

echo "üîê Fixing permissions..."
chown -R www-data:www-data backend/runtime backend/web/assets                    console/runtime                    frontend/runtime frontend/web/assets
chmod -R 775 backend/runtime backend/web/assets               console/runtime               frontend/runtime frontend/web/assets

echo "‚úÖ Deploy complete."
```

---

## 5. –ü–æ—à–∞–≥–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º

1. **–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞**
   - –†–∞–±–æ—Ç–∞—Ç—å –≤ –≤–µ—Ç–∫–µ `develop`.
   - –ö–æ–º–º–∏—Ç–∏—Ç—å –∏ –ø—É—à–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≤–µ—Ç–∫—É `develop`.
2. **–î–µ–ø–ª–æ–π –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä**
   - –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Ç–µ—Å—Ç–æ–≤–æ–º—É —Å–µ—Ä–≤–µ—Ä—É.
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç:  
     ```
     ./scripts/deploy_test.sh
     ```
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å–∞–π—Ç–∞ –Ω–∞ `test.super-lawyer.ru`.
3. **–ü–µ—Ä–µ–Ω–æ—Å –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω**
   - –°–ª–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ –≤–µ—Ç–∫–∏ `develop` –≤ `main` –Ω–∞ GitHub.
   - –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–µ—Ä–≤–µ—Ä—É.
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç:  
     ```
     ./scripts/deploy_prod.sh
     ```
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–∞–π—Ç–∞ –Ω–∞ `super-lawyer.ru`.

---

## 6. –í–∞–∂–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –º–µ–Ω—è—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –¥–µ–ø–ª–æ—è –≤—Ä—É—á–Ω—É—é –±–µ–∑ —Ñ–∏–∫—Å–∞—Ü–∏–∏ –≤ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–µ.
- –í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ.
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –ø–∞–ø–æ–∫ `runtime` –∏ `web/assets` –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `git config --global --add safe.directory` –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Git.
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ SSH-–∫–ª—é—á–∏ –±–µ–∑ –ø–∞—Ä–æ–ª—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.
- –ù–µ –∑–∞–ø—É—Å–∫–∞—Ç—å Composer –∫–∞–∫ root –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `COMPOSER_ALLOW_SUPERUSER=1` —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é).

---

# –ö–æ–Ω–µ—Ü —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∞
